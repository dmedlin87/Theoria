============================= test session starts =============================
platform win32 -- Python 3.12.6, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\dmedl\Projects\Theoria\.venv\Scripts\python.exe
cachedir: .pytest_cache
hypothesis profile 'default'
rootdir: C:\Users\dmedl\Projects\Theoria
configfile: pyproject.toml
plugins: anyio-4.11.0, hypothesis-6.140.2, cov-7.0.0, subtests-0.14.2, schemathesis-3.39.16
collecting ... collected 134 items

tests/api/test_ai_citation_export.py::test_export_citations_returns_csl_payload ERROR [  0%]
tests/api/test_ai_citation_export.py::test_export_citations_allows_missing_source_url ERROR [  1%]
tests/api/test_ai_citation_export.py::test_export_citations_rejects_empty_payload ERROR [  2%]
tests/api/test_ai_citation_export.py::test_export_citations_reports_missing_document ERROR [  2%]
tests/api/test_ai_citation_export.py::test_export_citations_requires_document_id ERROR [  3%]
tests/api/test_ai_citation_export.py::test_build_csl_entry_uses_expected_type[sermon-speech] PASSED [  4%]
tests/api/test_ai_citation_export.py::test_build_csl_entry_uses_expected_type[video-motion_picture] PASSED [  5%]
tests/api/test_ai_citation_export.py::test_build_csl_entry_uses_expected_type[web-webpage] PASSED [  5%]
tests/api/test_ai_citation_export.py::test_build_csl_entry_uses_expected_type[unknown-article-journal] PASSED [  6%]
tests/api/test_ai_exports.py::test_sermon_export_returns_serialised_asset[markdown] ERROR [  7%]
tests/api/test_ai_exports.py::test_sermon_export_returns_serialised_asset[ndjson] ERROR [  8%]
tests/api/test_ai_exports.py::test_sermon_export_returns_serialised_asset[csv] ERROR [  8%]
tests/api/test_ai_exports.py::test_sermon_export_returns_serialised_asset[pdf] ERROR [  9%]
tests/api/test_ai_exports.py::test_transcript_export_returns_serialised_asset[markdown] ERROR [ 10%]
tests/api/test_ai_exports.py::test_transcript_export_returns_serialised_asset[csv] ERROR [ 11%]
tests/api/test_ai_exports.py::test_transcript_export_returns_serialised_asset[pdf] ERROR [ 11%]
tests/api/test_ai_features_endpoint.py::test_ai_features_exposes_guardrail_catalogues FAILED [ 12%]
tests/api/test_ai_registry.py::test_settings_store_encrypts_and_decrypts PASSED [ 13%]
tests/api/test_ai_registry.py::test_registry_encrypts_api_keys_and_migrates_plaintext PASSED [ 14%]
tests/api/test_ai_registry.py::test_migrate_plaintext_settings_reencrypts PASSED [ 14%]
tests/api/test_ai_registry.py::test_build_client_dispatch[openai-config0-OpenAIClient] PASSED [ 15%]
tests/api/test_ai_registry.py::test_build_client_dispatch[azure-config1-AzureOpenAIClient] PASSED [ 16%]
tests/api/test_ai_registry.py::test_build_client_dispatch[anthropic-config2-AnthropicClient] PASSED [ 17%]
tests/api/test_ai_registry.py::test_build_client_dispatch[vertex-config3-VertexAIClient] PASSED [ 17%]
tests/api/test_ai_registry.py::test_build_client_dispatch[vllm-config4-LocalVLLMClient] PASSED [ 18%]
tests/api/test_ai_registry.py::test_registry_persists_model_metadata PASSED [ 19%]
tests/api/test_ai_registry.py::test_llm_routes_persist_metadata PASSED   [ 20%]
tests/api/test_ai_registry.py::test_llm_routes_openapi_schema PASSED     [ 20%]
tests/api/test_ai_registry.py::test_retry_backoff_respects_retry_after PASSED [ 21%]
tests/api/test_ai_registry.py::test_clients_inject_idempotency_keys_and_cache[<lambda>-payload0-Idempotency-Key-openai] PASSED [ 22%]
tests/api/test_ai_registry.py::test_clients_inject_idempotency_keys_and_cache[<lambda>-payload1-x-ms-client-request-id-azure] PASSED [ 23%]
tests/api/test_ai_registry.py::test_clients_inject_idempotency_keys_and_cache[<lambda>-payload2-anthropic-idempotency-key-anthropic] PASSED [ 23%]
tests/api/test_ai_registry.py::test_clients_inject_idempotency_keys_and_cache[<lambda>-payload3-x-request-id-vertex] PASSED [ 24%]
tests/api/test_ai_registry.py::test_clients_inject_idempotency_keys_and_cache[<lambda>-payload4-Idempotency-Key-local] PASSED [ 25%]
tests/api/test_ai_router.py::test_router_logs_warning_when_budget_projection_near_ceiling PASSED [ 26%]
tests/api/test_ai_router.py::test_router_logs_warning_when_latency_projection_near_threshold PASSED [ 26%]
tests/api/test_ai_router.py::test_router_logs_warning_when_budget_exceeded PASSED [ 27%]
tests/api/test_ai_router.py::test_router_logs_warning_when_latency_exceeded PASSED [ 28%]
tests/api/test_ai_router.py::test_router_respects_budget_and_falls_back PASSED [ 29%]
tests/api/test_ai_router.py::test_router_latency_threshold_triggers_fallback PASSED [ 29%]
tests/api/test_ai_router.py::test_router_generation_error_when_ledger_prepopulated PASSED [ 30%]
tests/api/test_ai_router.py::test_router_prefers_model_hint_and_falls_back PASSED [ 31%]
tests/api/test_ai_router.py::test_router_reuses_cache_entry PASSED       [ 32%]
tests/api/test_ai_router.py::test_router_deduplicates_inflight_requests FAILED [ 32%]
tests/api/test_ai_router.py::test_router_shared_spend_across_processes PASSED [ 33%]
tests/api/test_ai_router.py::test_router_shared_latency_across_processes PASSED [ 34%]
tests/api/test_ai_trails.py::test_trail_recorder_persists_retrieval_snapshots PASSED [ 35%]
tests/api/test_ai_trails.py::test_trail_replay_retains_retrieval_snapshots PASSED [ 35%]
tests/api/test_ai_watchlists.py::test_create_watchlist_assigns_principal_subject PASSED [ 36%]
tests/api/test_ai_watchlists.py::test_list_watchlists_filters_by_principal_subject PASSED [ 37%]
tests/api/test_ai_watchlists.py::test_other_user_watchlist_returns_not_found PASSED [ 38%]
tests/api/test_debug_reporting.py::test_build_debug_report_filters_sensitive_data PASSED [ 38%]
tests/api/test_debug_reporting.py::test_error_reporting_middleware_emits_report PASSED [ 39%]
tests/api/test_debug_reporting.py::test_debug_report_includes_trace_id PASSED [ 40%]
tests/api/test_digest_service.py::test_ensure_latest_returns_cached_when_within_ttl PASSED [ 41%]
tests/api/test_digest_service.py::test_ensure_latest_regenerates_when_expired PASSED [ 41%]
tests/api/test_ingest.py::test_ingest_file_streams_large_upload_without_buffering PASSED [ 42%]
tests/api/test_ingest.py::test_ingest_file_logs_large_body_as_truncated PASSED [ 43%]
tests/api/test_ingest.py::test_ingest_file_rejects_upload_exceeding_limit PASSED [ 44%]
tests/api/test_ingest.py::test_ingest_url_allows_http PASSED             [ 44%]
tests/api/test_ingest.py::test_ingest_url_rejects_disallowed_scheme[file:///etc/passwd] PASSED [ 45%]
tests/api/test_ingest.py::test_ingest_url_rejects_disallowed_scheme[gopher://example.com/resource] PASSED [ 46%]
tests/api/test_ingest.py::test_ingest_url_blocks_private_targets[http://localhost/resource] PASSED [ 47%]
tests/api/test_ingest.py::test_ingest_url_blocks_private_targets[http://127.0.0.1/secret] PASSED [ 47%]
tests/api/test_ingest.py::test_ingest_url_blocks_private_targets[http://192.168.1.10/internal] PASSED [ 48%]
tests/api/test_ingest.py::test_simple_ingest_streams_progress PASSED     [ 49%]
tests/api/test_ingest.py::test_simple_ingest_rejects_bad_source PASSED   [ 50%]
tests/api/test_ingest.py::test_ingest_url_times_out_on_slow_response FAILED [ 50%]
tests/api/test_ingest.py::test_ingest_url_rejects_oversized_response FAILED [ 51%]
tests/api/test_ingest.py::test_ingest_url_detects_redirect_loop FAILED   [ 52%]
tests/api/test_ingest.py::test_ingest_file_rejects_password_protected_pdf PASSED [ 52%]
tests/api/test_ingest.py::test_ingest_file_rejects_corrupt_pdf PASSED    [ 53%]
tests/api/test_ingest_duplicates.py::test_duplicate_file_ingest_returns_400 PASSED [ 54%]
tests/api/test_ingest_duplicates.py::test_duplicate_url_ingest_returns_400 PASSED [ 55%]
tests/api/test_ingest_uploads.py::test_ingest_file_sanitizes_uploaded_filename PASSED [ 55%]
tests/api/test_ingest_uploads.py::test_ingest_transcript_sanitizes_uploaded_files PASSED [ 56%]
tests/api/test_ingest_uploads.py::test_ingest_markdown_with_windows_1252_bytes FAILED [ 57%]
tests/api/test_ingest_uploads.py::test_ingest_html_with_windows_1252_bytes PASSED [ 58%]
tests/api/test_jobs_enqueue_regression.py::test_repro_enqueue_job_runtime_error PASSED [ 58%]
tests/api/test_jobs_refresh_hnsw.py::test_refresh_hnsw_job_endpoint_enqueues PASSED [ 59%]
tests/api/test_jobs_refresh_hnsw.py::test_refresh_hnsw_job_endpoint_uses_defaults PASSED [ 60%]
tests/api/test_jobs_validate_citations.py::test_validate_citations_job_endpoint_enqueues PASSED [ 61%]
tests/api/test_jobs_validate_citations.py::test_validate_citations_job_uses_default_limit PASSED [ 61%]
tests/api/test_rag_guardrails.py::test_cache_helpers_do_not_create_event_loop PASSED [ 62%]
tests/api/test_rag_guardrails.py::test_guarded_answer_accepts_valid_completion PASSED [ 63%]
tests/api/test_rag_guardrails.py::test_guarded_answer_rejects_mismatched_citations PASSED [ 64%]
tests/api/test_rag_guardrails.py::test_guarded_answer_requires_osis_reference PASSED [ 64%]
tests/api/test_rag_guardrails.py::test_guarded_answer_cache_hit_increments_metric PASSED [ 65%]
tests/api/test_rag_guardrails.py::test_guarded_answer_cache_stale_and_refresh_metrics PASSED [ 66%]
tests/api/test_rag_guardrails.py::test_guarded_answer_summary_uses_citation_documents PASSED [ 67%]
tests/api/test_rag_guardrails.py::test_guarded_answer_uses_echo_model PASSED [ 67%]
tests/api/test_rag_guardrails.py::test_guarded_answer_profile_mismatch_raises_guardrail_error PASSED [ 68%]
tests/api/test_rag_guardrails.py::test_guarded_answer_profile_match_includes_profile PASSED [ 69%]
tests/api/test_rag_guardrails.py::test_guarded_answer_reuses_cache PASSED [ 70%]
tests/api/test_rag_guardrails.py::test_guarded_answer_invalidates_stale_cache PASSED [ 70%]
tests/api/test_rag_guardrails.py::test_run_guarded_chat_reuses_cache PASSED [ 71%]
tests/api/test_rag_guardrails.py::test_run_guarded_chat_guardrail_violation_propagates PASSED [ 72%]
tests/api/test_rag_pdf_deliverables.py::test_build_sermon_deliverable_pdf_renders_binary PASSED [ 73%]
tests/api/test_rag_pdf_deliverables.py::test_build_transcript_deliverable_pdf_renders_binary PASSED [ 73%]
tests/api/test_research_dss_links.py::test_dss_links_endpoint_returns_matches PASSED [ 74%]
tests/api/test_research_dss_links.py::test_dss_links_endpoint_handles_ranges PASSED [ 75%]
tests/api/test_research_dss_links.py::test_dss_links_endpoint_handles_missing_osis PASSED [ 76%]
tests/api/test_security.py::test_missing_credentials_return_unauthorized[post-/ingest/url-kwargs0] PASSED [ 76%]
tests/api/test_security.py::test_missing_credentials_return_unauthorized[get-/ai/llm-kwargs1] PASSED [ 77%]
tests/api/test_security.py::test_missing_credentials_return_unauthorized[post-/ai/digest-kwargs2] PASSED [ 78%]
tests/api/test_security.py::test_missing_credentials_return_unauthorized[get-/documents-kwargs3] PASSED [ 79%]
tests/api/test_security.py::test_missing_credentials_return_unauthorized[get-/jobs-kwargs4] PASSED [ 79%]
tests/api/test_security.py::test_invalid_credentials_return_forbidden[post-/ingest/url-kwargs0] PASSED [ 80%]
tests/api/test_security.py::test_invalid_credentials_return_forbidden[get-/ai/llm-kwargs1] PASSED [ 81%]
tests/api/test_security.py::test_invalid_credentials_return_forbidden[post-/ai/digest-kwargs2] PASSED [ 82%]
tests/api/test_security.py::test_invalid_credentials_return_forbidden[get-/documents-kwargs3] PASSED [ 82%]
tests/api/test_security.py::test_invalid_credentials_return_forbidden[get-/jobs-kwargs4] PASSED [ 83%]
tests/api/test_security.py::test_api_key_allows_access[post-/ingest/url-kwargs0] PASSED [ 84%]
tests/api/test_security.py::test_api_key_allows_access[get-/ai/llm-kwargs1] PASSED [ 85%]
tests/api/test_security.py::test_api_key_allows_access[post-/ai/digest-kwargs2] PASSED [ 85%]
tests/api/test_security.py::test_api_key_allows_access[get-/documents-kwargs3] PASSED [ 86%]
tests/api/test_security.py::test_api_key_allows_access[get-/jobs-kwargs4] PASSED [ 87%]
tests/api/test_security.py::test_jwt_allows_access PASSED                [ 88%]
tests/api/test_security.py::test_anonymous_access_allowed_when_auth_unconfigured PASSED [ 88%]
tests/api/test_sql_migrations.py::test_sql_migrations_run_on_startup PASSED [ 89%]
tests/api/test_sql_migrations.py::test_cli_entry_point_invokes_runner PASSED [ 90%]
tests/api/test_telemetry.py::test_repro_workflow_context_dict_serialization[value0] PASSED [ 91%]
tests/api/test_telemetry.py::test_repro_workflow_context_dict_serialization[value1] PASSED [ 91%]
tests/api/test_verse_timeline.py::test_get_verse_timeline_groups_mentions_by_month PASSED [ 92%]
tests/api/test_verse_timeline.py::test_get_verse_timeline_filters_by_source_type PASSED [ 93%]
tests/api/test_verse_timeline.py::test_get_verse_timeline_respects_limit PASSED [ 94%]
tests/api/test_verse_timeline.py::test_get_verse_timeline_rejects_invalid_window PASSED [ 94%]
tests/api/test_verse_timeline.py::test_get_verse_timeline_filters_by_author_for_week_window PASSED [ 95%]
tests/api/test_watchlist_performance.py::test_document_window_query_uses_created_at_index PASSED [ 96%]
tests/api/test_watchlist_performance.py::test_watchlist_event_query_uses_run_started_index PASSED [ 97%]
tests/api/test_workflow_spans.py::test_multimedia_digest_emits_span_and_records_steps PASSED [ 97%]
tests/api/test_workflow_spans.py::test_devotional_flow_emits_span PASSED [ 98%]
tests/api/test_workflow_spans.py::test_research_reconciliation_emits_span PASSED [ 99%]
tests/api/test_workflow_spans.py::test_corpus_curation_emits_span PASSED [100%]

=================================== ERRORS ====================================
_________ ERROR at setup of test_export_citations_returns_csl_payload _________
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_citation_export.py:73: in client
    with TestClient(app) as test_client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
______ ERROR at setup of test_export_citations_allows_missing_source_url ______
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_citation_export.py:73: in client
    with TestClient(app) as test_client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
________ ERROR at setup of test_export_citations_rejects_empty_payload ________
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_citation_export.py:73: in client
    with TestClient(app) as test_client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
______ ERROR at setup of test_export_citations_reports_missing_document _______
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_citation_export.py:73: in client
    with TestClient(app) as test_client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
________ ERROR at setup of test_export_citations_requires_document_id _________
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_citation_export.py:73: in client
    with TestClient(app) as test_client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
___ ERROR at setup of test_sermon_export_returns_serialised_asset[markdown] ___
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_exports.py:61: in api_client
    with TestClient(app) as client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
____ ERROR at setup of test_sermon_export_returns_serialised_asset[ndjson] ____
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_exports.py:61: in api_client
    with TestClient(app) as client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
_____ ERROR at setup of test_sermon_export_returns_serialised_asset[csv] ______
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_exports.py:61: in api_client
    with TestClient(app) as client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
_____ ERROR at setup of test_sermon_export_returns_serialised_asset[pdf] ______
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_exports.py:61: in api_client
    with TestClient(app) as client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
_ ERROR at setup of test_transcript_export_returns_serialised_asset[markdown] _
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_exports.py:61: in api_client
    with TestClient(app) as client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
___ ERROR at setup of test_transcript_export_returns_serialised_asset[csv] ____
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_exports.py:61: in api_client
    with TestClient(app) as client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
___ ERROR at setup of test_transcript_export_returns_serialised_asset[pdf] ____
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_exports.py:61: in api_client
    with TestClient(app) as client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
================================== FAILURES ===================================
________________ test_ai_features_exposes_guardrail_catalogues ________________
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlite3.OperationalError: no such column: contradiction_seeds.perspective

The above exception was the direct cause of the following exception:
tests\api\test_ai_features_endpoint.py:14: in test_ai_features_exposes_guardrail_catalogues
    with TestClient(app) as client:
         ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:743: in __enter__
    portal.call(self.wait_startup)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:778: in wait_startup
    await receive()
.venv\Lib\site-packages\starlette\testclient.py:769: in receive
    self.task.result()
C:\Python312\Lib\concurrent\futures\_base.py:449: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:759: in lifespan
    await self.app(scope, self.stream_receive.receive, self.stream_send.send)
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:152: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\base.py:101: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\cors.py:77: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:48: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:724: in app
    await self.lifespan(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:693: in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:209: in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:117: in lifespan
    seed_reference_data(session)
theo\services\api\app\db\seeds.py:361: in seed_reference_data
    seed_contradiction_claims(session)
theo\services\api\app\db\seeds.py:102: in seed_contradiction_claims
    record = session.get(ContradictionSeed, identifier)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3694: in get
    return self._get_impl(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:3873: in _get_impl
    return db_load_fn(
.venv\Lib\site-packages\sqlalchemy\orm\loading.py:695: in load_on_pk_identity
    session.execute(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2365: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2251: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
.venv\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv\Lib\site-packages\sqlalchemy\engine\default.py:951: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: contradiction_seeds.perspective
E   [SQL: SELECT contradiction_seeds.id AS contradiction_seeds_id, contradiction_seeds.osis_a AS contradiction_seeds_osis_a, contradiction_seeds.osis_b AS contradiction_seeds_osis_b, contradiction_seeds.summary AS contradiction_seeds_summary, contradiction_seeds.source AS contradiction_seeds_source, contradiction_seeds.tags AS contradiction_seeds_tags, contradiction_seeds.weight AS contradiction_seeds_weight, contradiction_seeds.perspective AS contradiction_seeds_perspective, contradiction_seeds.created_at AS contradiction_seeds_created_at 
E   FROM contradiction_seeds 
E   WHERE contradiction_seeds.id = ?]
E   [parameters: ('c6fcf110-0db4-5237-86f2-f010a1f69772',)]
E   (Background on this error at: https://sqlalche.me/e/20/e3q8)
_________________ test_router_deduplicates_inflight_requests __________________
tests\api\test_ai_router.py:470: in test_router_deduplicates_inflight_requests
    results = [future.result() for future in futures]
               ^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
C:\Python312\Lib\concurrent\futures\thread.py:58: in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests\api\test_ai_router.py:466: in _invoke
    return router.execute_generation(workflow="chat", model=model, prompt="simultaneous")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\ai\router.py:209: in execute_generation
    record = self._ledger.wait_for_inflight(cache_key)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\ai\ledger.py:438: in wait_for_inflight
    raise GenerationError(
E   theo.infrastructure.api.app.ai.clients.GenerationError: Deduplicated generation completed without a result
_________________ test_ingest_url_times_out_on_slow_response __________________
tests\api\test_ingest.py:330: in test_ingest_url_times_out_on_slow_response
    assert response.status_code == status.HTTP_400_BAD_REQUEST
E   assert 500 == 400
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
E    +  and   400 = status.HTTP_400_BAD_REQUEST
----------------------------- Captured log setup ------------------------------
WARNING  theo.application.services.geo.seed_openbible_geo:seed_openbible_geo.py:236 OpenBible geo dataset not available at C:\Users\dmedl\Projects\Theoria\theo\data\providers\openbible-geo\data
------------------------------ Captured log call ------------------------------
ERROR    theo.api.errors:reporting.py:189 api.debug_report
_________________ test_ingest_url_rejects_oversized_response __________________
tests\api\test_ingest.py:374: in test_ingest_url_rejects_oversized_response
    assert response.status_code == status.HTTP_400_BAD_REQUEST
E   assert 500 == 400
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
E    +  and   400 = status.HTTP_400_BAD_REQUEST
----------------------------- Captured log setup ------------------------------
WARNING  theo.application.services.geo.seed_openbible_geo:seed_openbible_geo.py:236 OpenBible geo dataset not available at C:\Users\dmedl\Projects\Theoria\theo\data\providers\openbible-geo\data
------------------------------ Captured log call ------------------------------
ERROR    theo.api.errors:reporting.py:189 api.debug_report
____________________ test_ingest_url_detects_redirect_loop ____________________
tests\api\test_ingest.py:441: in test_ingest_url_detects_redirect_loop
    assert response.status_code == status.HTTP_400_BAD_REQUEST
E   assert 500 == 400
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
E    +  and   400 = status.HTTP_400_BAD_REQUEST
----------------------------- Captured log setup ------------------------------
WARNING  theo.application.services.geo.seed_openbible_geo:seed_openbible_geo.py:236 OpenBible geo dataset not available at C:\Users\dmedl\Projects\Theoria\theo\data\providers\openbible-geo\data
------------------------------ Captured log call ------------------------------
ERROR    theo.api.errors:reporting.py:189 api.debug_report
________________ test_ingest_markdown_with_windows_1252_bytes _________________
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\_pytest\runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\_pytest\runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\_pytest\logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\_pytest\capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\_pytest\skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\_pytest\runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\_pytest\python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "c:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\schemathesis\extra\pytest_plugin.py", line 312, in pytest_pyfunc_call
    |     yield
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\_pytest\python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\tests\api\test_ingest_uploads.py", line 151, in test_ingest_markdown_with_windows_1252_bytes
    |     response = api_client.post(
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\testclient.py", line 597, in post
    |     return super().post(
    |            ^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 1157, in post
    |     return self.request(
    |            ^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\testclient.py", line 488, in request
    |     return super().request(
    |            ^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 837, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 926, in send
    |     response = self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 954, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 991, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 1027, in _send_single_request
    |     response = transport.handle_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\testclient.py", line 381, in handle_request
    |     raise exc
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\testclient.py", line 378, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\anyio\from_thread.py", line 321, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Python312\Lib\concurrent\futures\_base.py", line 456, in result
    |     return self.__get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "C:\Python312\Lib\concurrent\futures\_base.py", line 401, in __get_result
    |     raise self._exception
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\anyio\from_thread.py", line 252, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\applications.py", line 1133, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\errors.py", line 187, in __call__
    |     raise exc
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\theo\services\api\app\main.py", line 160, in add_trace_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\theo\services\api\app\debug\middleware.py", line 51, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_exception_handler.py", line 62, in wrapped_app
    |     raise exc
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_exception_handler.py", line 51, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\routing.py", line 123, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_exception_handler.py", line 62, in wrapped_app
    |     raise exc
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_exception_handler.py", line 51, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\routing.py", line 109, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\routing.py", line 387, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\routing.py", line 288, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\theo\services\api\app\routes\ingest.py", line 122, in ingest_file
    |     document = run_pipeline_for_file(session, tmp_path, parsed_frontmatter)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\dmedl\Projects\Theoria\tests\api\test_ingest_uploads.py", line 135, in fake_pipeline
    |     body, _ = ingest_pipeline._parse_text_file(path)
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | AttributeError: module 'theo.infrastructure.api.app.ingest.pipeline' has no attribute '_parse_text_file'. Did you mean: 'parse_text_file'?
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\dmedl\Projects\Theoria\tests\api\test_ingest_uploads.py", line 151, in test_ingest_markdown_with_windows_1252_bytes
    response = api_client.post(
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\testclient.py", line 597, in post
    return super().post(
           ^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 1157, in post
    return self.request(
           ^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\testclient.py", line 488, in request
    return super().request(
           ^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 837, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 926, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 954, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 991, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\httpx\_client.py", line 1027, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\testclient.py", line 381, in handle_request
    raise exc
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\testclient.py", line 378, in handle_request
    portal.call(self.app, scope, receive, send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\anyio\from_thread.py", line 321, in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\concurrent\futures\_base.py", line 456, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\concurrent\futures\_base.py", line 401, in __get_result
    raise self._exception
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\anyio\from_thread.py", line 252, in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\errors.py", line 187, in __call__
    raise exc
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\theo\services\api\app\main.py", line 160, in add_trace_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\theo\services\api\app\debug\middleware.py", line 51, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_exception_handler.py", line 62, in wrapped_app
    raise exc
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_exception_handler.py", line 51, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_exception_handler.py", line 62, in wrapped_app
    raise exc
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\starlette\_exception_handler.py", line 51, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\routing.py", line 387, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\fastapi\routing.py", line 288, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\theo\services\api\app\routes\ingest.py", line 122, in ingest_file
    document = run_pipeline_for_file(session, tmp_path, parsed_frontmatter)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\dmedl\Projects\Theoria\tests\api\test_ingest_uploads.py", line 135, in fake_pipeline
    body, _ = ingest_pipeline._parse_text_file(path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'theo.infrastructure.api.app.ingest.pipeline' has no attribute '_parse_text_file'. Did you mean: 'parse_text_file'?

During handling of the above exception, another exception occurred:
tests\api\test_ingest_uploads.py:151: in test_ingest_markdown_with_windows_1252_bytes
    response = api_client.post(
.venv\Lib\site-packages\starlette\testclient.py:597: in post
    return super().post(
.venv\Lib\site-packages\httpx\_client.py:1157: in post
    return self.request(
.venv\Lib\site-packages\starlette\testclient.py:488: in request
    return super().request(
.venv\Lib\site-packages\httpx\_client.py:837: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\httpx\_client.py:926: in send
    response = self._send_handling_auth(
.venv\Lib\site-packages\httpx\_client.py:954: in _send_handling_auth
    response = self._send_handling_redirects(
.venv\Lib\site-packages\httpx\_client.py:991: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\httpx\_client.py:1027: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\testclient.py:381: in handle_request
    raise exc
.venv\Lib\site-packages\starlette\testclient.py:378: in handle_request
    portal.call(self.app, scope, receive, send)
.venv\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
.venv\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
.venv\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\errors.py:187: in __call__
    raise exc
.venv\Lib\site-packages\starlette\middleware\errors.py:165: in __call__
    await self.app(scope, receive, _send)
.venv\Lib\site-packages\starlette\middleware\base.py:185: in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:158: in __exit__
    self.gen.throw(value)
.venv\Lib\site-packages\starlette\_utils.py:82: in collapse_excgroups
    raise exc
.venv\Lib\site-packages\starlette\middleware\base.py:187: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\main.py:160: in add_trace_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\middleware\base.py:163: in call_next
    raise app_exc
.venv\Lib\site-packages\starlette\middleware\base.py:149: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv\Lib\site-packages\starlette\middleware\base.py:185: in __call__
    with collapse_excgroups():
         ^^^^^^^^^^^^^^^^^^^^
C:\Python312\Lib\contextlib.py:158: in __exit__
    self.gen.throw(value)
.venv\Lib\site-packages\starlette\_utils.py:82: in collapse_excgroups
    raise exc
.venv\Lib\site-packages\starlette\middleware\base.py:187: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\debug\middleware.py:51: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\starlette\middleware\base.py:163: in call_next
    raise app_exc
.venv\Lib\site-packages\starlette\middleware\base.py:149: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
.venv\Lib\site-packages\starlette\middleware\cors.py:85: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\middleware\exceptions.py:62: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
.venv\Lib\site-packages\starlette\_exception_handler.py:62: in wrapped_app
    raise exc
.venv\Lib\site-packages\starlette\_exception_handler.py:51: in wrapped_app
    await app(scope, receive, sender)
.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:715: in __call__
    await self.middleware_stack(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:735: in app
    await route.handle(scope, receive, send)
.venv\Lib\site-packages\starlette\routing.py:288: in handle
    await self.app(scope, receive, send)
.venv\Lib\site-packages\fastapi\routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
.venv\Lib\site-packages\starlette\_exception_handler.py:62: in wrapped_app
    raise exc
.venv\Lib\site-packages\starlette\_exception_handler.py:51: in wrapped_app
    await app(scope, receive, sender)
.venv\Lib\site-packages\fastapi\routing.py:109: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\fastapi\routing.py:387: in app
    raw_response = await run_endpoint_function(
.venv\Lib\site-packages\fastapi\routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
theo\services\api\app\routes\ingest.py:122: in ingest_file
    document = run_pipeline_for_file(session, tmp_path, parsed_frontmatter)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests\api\test_ingest_uploads.py:135: in fake_pipeline
    body, _ = ingest_pipeline._parse_text_file(path)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'theo.infrastructure.api.app.ingest.pipeline' has no attribute '_parse_text_file'. Did you mean: 'parse_text_file'?
----------------------------- Captured log setup ------------------------------
WARNING  theo.application.services.geo.seed_openbible_geo:seed_openbible_geo.py:236 OpenBible geo dataset not available at C:\Users\dmedl\Projects\Theoria\theo\data\providers\openbible-geo\data
------------------------------ Captured log call ------------------------------
ERROR    theo.api.errors:reporting.py:189 api.debug_report
============================== warnings summary ===============================
.venv\Lib\site-packages\schemathesis\generation\coverage.py:305
  c:\Users\dmedl\Projects\Theoria\.venv\Lib\site-packages\schemathesis\generation\coverage.py:305: DeprecationWarning: jsonschema.exceptions.RefResolutionError is deprecated as of version 4.18.0. If you wish to catch potential reference resolution errors, directly catch referencing.exceptions.Unresolvable.
    ref_error: type[Exception] = jsonschema.RefResolutionError,

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/api/test_ai_features_endpoint.py::test_ai_features_exposes_guardrail_catalogues
FAILED tests/api/test_ai_router.py::test_router_deduplicates_inflight_requests
FAILED tests/api/test_ingest.py::test_ingest_url_times_out_on_slow_response
FAILED tests/api/test_ingest.py::test_ingest_url_rejects_oversized_response
FAILED tests/api/test_ingest.py::test_ingest_url_detects_redirect_loop - asse...
FAILED tests/api/test_ingest_uploads.py::test_ingest_markdown_with_windows_1252_bytes
ERROR tests/api/test_ai_citation_export.py::test_export_citations_returns_csl_payload
ERROR tests/api/test_ai_citation_export.py::test_export_citations_allows_missing_source_url
ERROR tests/api/test_ai_citation_export.py::test_export_citations_rejects_empty_payload
ERROR tests/api/test_ai_citation_export.py::test_export_citations_reports_missing_document
ERROR tests/api/test_ai_citation_export.py::test_export_citations_requires_document_id
ERROR tests/api/test_ai_exports.py::test_sermon_export_returns_serialised_asset[markdown]
ERROR tests/api/test_ai_exports.py::test_sermon_export_returns_serialised_asset[ndjson]
ERROR tests/api/test_ai_exports.py::test_sermon_export_returns_serialised_asset[csv]
ERROR tests/api/test_ai_exports.py::test_sermon_export_returns_serialised_asset[pdf]
ERROR tests/api/test_ai_exports.py::test_transcript_export_returns_serialised_asset[markdown]
ERROR tests/api/test_ai_exports.py::test_transcript_export_returns_serialised_asset[csv]
ERROR tests/api/test_ai_exports.py::test_transcript_export_returns_serialised_asset[pdf]
============ 6 failed, 116 passed, 1 warning, 12 errors in 30.11s =============
